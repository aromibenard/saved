// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

/// Core configuration for the tracker (single-user)
model SavingsProfile {
  id          String   @id @default(cuid())
  currency    String   @default("KES")
  dailyGoal   Int? // optional: target per day
  monthlyGoal Int? // optional: target per month
  startDate   DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

/// Raw append-only savings entries (SOURCE OF TRUTH)
/// amount supports NEGATIVE values (withdrawals)
model SavingsLog {
  id         String   @id @default(cuid())
  amount     Int // positive = save, negative = withdraw (minor units)
  note       String?
  occurredAt DateTime // when the transaction happened (UTC)
  createdAt  DateTime @default(now())

  @@index([occurredAt])
}

/// One row per calendar day (DERIVED)
/// Net-based logic drives streaks and charts
model DailySavings {
  /// Normalized to 00:00:00 UTC for the day
  date DateTime @id

  /// Net amount for the day (sum of SavingsLog.amount)
  netAmount Int

  /// Number of log entries for the day
  entriesCount Int

  /// Convenience flags for analytics & UI
  isSavingDay Boolean // netAmount > 0
  hasActivity Boolean // entriesCount > 0

  /// Position within the CURRENT active streak (optional UI helper)
  streakIndex Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

/// Monthly rollups for fast dashboards (DERIVED)
model MonthlySavings {
  /// Normalized to first day of month 00:00 UTC
  month DateTime @id

  totalNetAmount Int
}
